<div id="blog_body">

  <div id="blog_page_container">


    <!-- POSTS INDEX -->
    <div id="blog_posts_index_column">

      <div id="original_blog_tab">
        <h1>THE ORIGINAL BLOG</h1>
        <h5>Complete and Unedited</h5>
      </div>

      <div id="blog_posts_image">
        <% if @post.title =~ /DEAD IN BED/ && @post.title.slice(18,19).to_i < 9 %>
          <%= image_tag("DiB#{@post.title.split('')[18]} cover.jpg", alt: "Part #{@post.title.split('')[18]} Cover", class: "post_cover") %>
        <% else %>
          <%= image_tag("Bailey Simms pic.jpg", alt: "Bailey Simms", class: "post_portrait") %>
        <% end %>
      </div>

      <div id="featured_post">
        <% if @post.id > 1 %>
          <p class="date"><%= @post.date.strftime("%A, %B #{@post.date.day.ordinalize}, %Y. %l:%M %P.") %></p>
          <p class="title"><%= @post.title %></p>
        <% end %>
      </div>

      <div id="posts_index_activator_div" class="phone_only tablet_only">
        <%= image_tag("down.png", alt: "down arrow", id: "posts_index_activator") %>
      </div>

      <div id="blog_posts_index">
      	<ul>
      	<% @posts.each do |post| %>
          <% if post.id > 1 %>
            <% if post.id == params[:id].to_i %>
              <li class = "current_post">
            <% else %>
              <li>
            <% end %>
      	    	<%= link_to post do %>
      	    	<p id="date"><%= post.date.strftime("%-m/%-d/%Y %l:%M %p") %></p>
      	      <p id="title"><%= post.title %></p>
      	    	<% end %>
      	    </li>
          <% end %>
      	<% end %>
      	</ul>
      </div>

    </div>



    <!-- BLOG POST -->
    <div id="blog_post">
      <% if @post.id == 1 %>
        <%= render 'posts/intro_statement' %>
      <% else %>

        <% if logged_in? && current_user.admin? %>
          <%= (link_to "edit |", edit_post_path(@post.id), class: "post_edit_delete_links")%>
          <%= (link_to " delete", @post,  class: "post_edit_delete_links", 
                                          method: :delete, 
                                          data: { confirm: "You sure you want to delete this post?" }) %>
        <% end %>  

        <h4><%= @post.date.strftime("%A, %B #{@post.date.day.ordinalize}, %Y. %l:%M %P.") %></h4>
        <h1><%= @post.title %></h1>


        <!-- criteria to DISPLAY a post's content -->
        <% if @post.visible_to_public || logged_in? && ( (@post.visible_to_users && current_user.has_unlocked?(@post.book_part) ) || current_user.vip? || current_user.admin? ) %>

          <%= raw @post.content %>

                        <div class="facebook_share_div">
                          <p><b>Spread the word, not the plague.</b></p> 
                          <br><p><i>Share Bailey's blog on Facebook before you sneak over to her next post:</i></p>
                          <!-- for shares that unlock the NEXT part (by sharing the current part) -->
                          <div class="facebook_share_this_part_button">
                            Share
                          </div>
                        </div>

                        <% if @post.id+1 <= Post.count %>
                          <div id="read_next_button"><%= link_to 'NEXT POST âž¤', post_path(@post.id+1) %></div>
                        <% end %>

        <!-- criteria to HIDE a post's content and request an action in order to see it -->
        <% elsif @post.visible_to_users %>
          <!-- (request log in) -->
          <% if !logged_in? %> 
            <div id="login_request">
              <h3>Hi! You have to <%= link_to "log in", login_path %> to read this post.</h3><br>
              <h3>New user? <%= link_to "Sign up here", new_user_path %>.</h3><br><br><br>
              <h3 style="text-align:right">Thx!</h3>
              <h3 style="text-align:right">xxBailey</h3>
            </div>
            <!-- (request share) -->
          <% elsif logged_in? && !current_user.has_unlocked?(@post.book_part) %>
                      
                        <div class="facebook_share_div">
                          <p><b>Spread the word, not the plague.</b></p> 
                            <% if current_user.has_shared_website  %>
                              <br><p><i>Tell your facebook friends how you liked Part <%=@post.book_part-1%> before you tear into Part <%=@post.book_part%>:</i></p>
                            <% else %>
                              <br><p><i>Share Bailey's blog on Facebook before you read this post:</i></p>
                            <% end %>  
                          <!-- for shares that unlock the CURRENT part (by sharing the previous part or the website) -->
                          <div class="facebook_share_previous_part_button">
                            Share
                          </div>
                        </div> 
          <% end %>

        <!-- criteria to HIDE a post's content to anyone but admin or vip -->
        <% elsif !@post.visible_to_users %>
          <div id="no_access">
            <h3>Access to this post<br>is coming soon.</h3>
          </div>
        <% end %>

      <% end %>
    </div>



    <!-- COMMENTS -->
    <div id="blog_comments_container">
      <% if logged_in? && ( @post.visible_to_users || current_user.vip? || current_user.admin? ) %> 
        <%= render 'shared/comment_form' %>
        <%= render 'shared/feed' %>
      <% elsif !logged_in? && @post.visible_to_users %>
        <p id="blog_comments_login_request">
          <i>Please <%= link_to "log in", login_path %> to comment.<br> New user? <%= link_to "Sign up", new_user_path %>.</i>
        </p>
        <%= render 'shared/feed' %>
      <% end %>
    </div>


  </div> 

</div>


